<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ARあやかちゃん</title>
    <meta property="og:title" content="title:ARあやかちゃん"> 
    <meta property="og:description" content="description:ARのあやかちゃんです。">
    <meta property="og:image" content="ayakachanOGP.jpg">
    <link rel="icon" href="/favicon.ico" id="favicon">
    <link rel="apple-touch-icon" sizes="256x256" href="favicon-256.ico">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.0/aframe/build/aframe-ar.js"></script>
     <!-- アニメーション用 -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
     <!-- 画面コントロール -->
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <a-scene embedded arjs vr-mode-ui="enabled: false;" renderer="logarithmicDepthBuffer: true;">
        <a-entity light="type: directional; color: #fff; castShadow:true;"
                  position="-10 10 10"></a-entity>
        <a-entity camera look-controls orbit-controls="target: 0 1.6 -0.5; maxPolarAngle:180; minDistance: 0.5; maxDistance: 200; initialPosition: 0 0 30"></a-entity>
            <!-- 3Dモデル（gltfファイル） -->
            <a-gltf-model id="model" src="AyakaChan.gltf" position="-8 -5 0" rotation="0 0 0" scale="8 8 8" animation-mixer></a-gltf-model>
        </a-scene>
        <button id="screenshot-button">AA</button>
  </body>
  <script>
    //glTFの表示が暗くなる問題に対処
    document.querySelector("a-scene").renderer.gammaOutput=true;
    document.getElementById('arjsDebugUIContainer').innerHTML='';
    document.getElementById("screenshot-button").addEventListener("click", function() {
    html2canvas(document.body).then(function(canvas) {
        // カメラ画像を取得する為、AR.jsで展開されているvideoを取得
        var camera = document.querySelector('video');
        // 空のキャンバスを用意
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        
        var width = camera.videoWidth;
        var height = camera.videoHeight;

        // A-Frameで描画しているSceneを取得
        var aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");

        if (width && height) {
            // カメラのサイズをcanvasにセット
            canvas.width = width;
            canvas.height = height;

            // canvasにカメラ画像を描いてからglbが映っているsceneを上書き
            context.drawImage(camera, 0, 0, width, height);
            context.drawImage(aScene, 0, 0, width, height);

            // png画像を作成
            var snap = canvas.toDataURL('image/png');
            var link = document.createElement("a");
            link.href = snap;
            link.download = "screenshot.png";

            //自動ダウンロード(クリック)
            link.click();
        }
    });
    })
</script>
</html>